<section class="grafico" id="grafico">
    <div class="subtitulo">
        <h1>Gráficos</h1>
    </div>

    <div class="conteudo">
        <div class="barras-de-medicoes-na">
            <div  style="display: inline-block;"">
                <div>
                    <label>Data:</label><br>
                    <input type="text" id="datePickerInput" style="width: 200px; display: inline-block;" placeholder="Escolha uma data">
                        <div id="datePickerOptions" style="color: black; display: none;">
                            <label><input type="radio" name="period" value="day"> Dia</label>
                            <label><input type="radio" name="period" value="week"> Semana</label>
                            <label><input type="radio" name="period" value="month"> Mês</label>
                            <label><input type="radio" name="period" value="semester"> Semestre</label>
                            <label><input type="radio" name="period" value="year"> Ano</label>
                            <br>
                            <label><input type="radio" name="time" value="current" checked> Atual</label>
                            <label><input type="radio" name="time" value="past"> Passado</label>
                        </div>
                    </div>

                    <script>
                        const datePickerInput = document.getElementById("datePickerInput");
                        const datePickerOptions = document.getElementById("datePickerOptions");
                        const tomorrow = new Date();
                        tomorrow.setDate(tomorrow.getDate() + 1);
                    
                        const flatpickrInstance = flatpickr(datePickerInput, {
                            mode: "range",
                            maxDate: tomorrow,
                            dateFormat: "d/m/Y",
                            locale: "pt",
                            firstDayOfWeek: 0,

                            onReady: function () {
                                const fp = this;
                                if (!fp.calendarContainer.contains(datePickerOptions)) {
                                    fp.calendarContainer.appendChild(datePickerOptions);
                                }
                                datePickerOptions.style.display = 'block';
                            },
                        
                            onClose: function (selectedDates, dateStr) {
                                updateGraph(dateStr);
                            },

                            onOpen: function () {
                                datePickerOptions.style.display = 'block';
                            },
                        });
                
                        datePickerOptions.addEventListener("change", function (event) {
                            if (event.target.name === "period" || event.target.name === "time") {
                                flatpickrInstance.close();
                                updateDatePicker(flatpickrInstance);
                                flatpickrInstance.open();
                            }
                        });
                
                        // Restante do código
                
                        function updateDatePicker(fp) {
                            const period = document.querySelector('input[name="period"]:checked').value;
                            const time = document.querySelector('input[name="time"]:checked').value;
                            const today = new Date();
                            let startDate = new Date(today);
                            let endDate = new Date(today);
                
                            if (period === "day") {
                                if (time === "past") {
                                    startDate.setDate(startDate.getDate() - 1);
                                    endDate.setDate(endDate.getDate() - 1);
                                }
                            } else if (period === "week") {
                                if (time === "current") {
                                    startDate.setDate(startDate.getDate() - (startDate.getDay() - 1));
                                } else {
                                    startDate.setDate(startDate.getDate() - (startDate.getDay() + 6));
                                    endDate.setDate(startDate.getDate() + 6);
                                }
                                
                            } else if (period === "month") {
                                if (time === "past") {
                                    startDate.setMonth(startDate.getMonth() - 1);
                                    endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0);
                                }
                                startDate.setDate(1);
                                
                            } else if (period === "semester") {
                                if (time === "past") {
                                    startDate.setMonth(startDate.getMonth() - 6);
                                    endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 6, 0);
                                }
                                startDate.setMonth(Math.floor(startDate.getMonth() / 6) * 6);
                                startDate.setDate(1);
                            } else if (period === "year") {
                                if (time === "past") {
                                    startDate.setFullYear(startDate.getFullYear() - 1);
                                    endDate = new Date(startDate.getFullYear() + 1, 0, 0);
                                }
                                startDate.setMonth(0);
                                startDate.setDate(1); 
                            }
                
                            fp.setDate([startDate, endDate]);
                        }
                
                        function updateGraph(dateStr) {
                            const rowsExample1 = [
                                ["08:00", 10],
                                ["09:00", 15],
                                ["10:00", 20],
                                ];

                                drawGenericChart(
                                    "chart_div",
                                    "AreaChart",
                                    "Consumo Diário",
                                    "Horário",
                                    "Potência",
                                    rowsExample1,
                                    null
                                    );

                            const dates = dateStr.split(" to ");
                            if (dates.length === 1) {
                                console.log( dates[0]);
                            } else if (dates.length === 2) {
                            console.log(`${dates[0]} até ${dates[1]}`);
                            }
                        }
                
                        datePickerLabel.addEventListener("click", function () {
                            flatpickrInstance.open();
                        });
                    </script>

                    <br>
                    <label for="grandeza_grafico">Grandeza:</label><br>
                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="consumo" name="grandeza_grafico" value="consumo" checked>
                        Consumo
                    </label><br>

                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="qualidade" name="grandeza_grafico" value="qualidade">
                        Qualidade
                    </label><br>

                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="dic" name="grandeza_grafico" value="dic">
                        DIC
                    </label><br>

                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="fic" name="grandeza_grafico" value="fic">
                        FIC
                    </label><br>

                    <br>
                    <label for="tipo_grafico">Tipo:</label><br>
                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="linhas" name="tipo_grafico" value="linhas" checked>
                        Grafico de linhas
                    </label><br>

                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" id="barras" name="tipo_grafico" value="barras">
                        Grafico de barras
                    </label><br>
                </div>

                <div id="chart_div" style="width: 100%; height: 400px;"></div>

            </div>

        </div>
        
    </div>
</section>